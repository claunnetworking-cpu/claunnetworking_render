# render.yaml
# Configuração final para o monorepo ClaunNetworking

services:
  # ----------------------------------------------------------------
  # 1. Serviço de Backend (Web Service)
  # ----------------------------------------------------------------
  - type: web
    name: claunnetworking-backend
    env: python
    
    # Define a subpasta 'backend' como o diretório raiz para este serviço
    # Assumindo que app.py, db_init.py e requirements.txt estão em 'backend/'
    rootDir: backend
    
    # Comando de Build: Instala as dependências do requirements.txt dentro de 'backend'
    buildCommand: pip install -r requirements.txt
    
    # Comando de Pré-Deploy: Ativa o ambiente virtual e executa o script de inicialização do DB
    # Nota: O log de erro anterior mostra que o Render executa o preDeployCommand no ambiente virtual.
    preDeployCommand: python3 db_init.py
    
    # Comando de Inicialização: Inicia o servidor Gunicorn no ambiente virtual
    # CORREÇÃO: Removido 'python3 -m' e adicionado 'source $VIRTUAL_ENV/bin/activate &&'
    # O Render já ativa o ambiente virtual para o startCommand, mas para garantir que o Gunicorn
    # seja encontrado no PATH do ambiente virtual, o comando mais limpo é apenas 'gunicorn app:app'.
    # Se o Render não estiver ativando o ambiente virtual corretamente, a forma mais robusta é:
    # startCommand: source $VIRTUAL_ENV/bin/activate && gunicorn app:app
    # No entanto, a documentação do Render sugere que apenas 'gunicorn app:app' é suficiente
    # quando o buildCommand é 'pip install -r requirements.txt'.
    # Vamos usar a forma mais limpa, que é a recomendada pelo Render para Python:
    startCommand: gunicorn app:app
    
    # Variáveis de Ambiente (Com dados fornecidos pelo usuário)
    envVars:
      - key: DATABASE_URL
        # URL de conexão do PostgreSQL fornecida pelo usuário
        value: "postgresql://claunnetworking_user:SHZXzj6270IughZA7c5mLJYqPxe6bzNe@dpg-d3pcfr49c44c73budb40-a/claunnetworking" 
      - key: SECRET_KEY
        # Chave secreta fornecida pelo usuário
        value: "927d3e4f6a1b8c5d0e2f4a7b9c1d0e3f5a6b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f"
      - key: PYTHON_VERSION
        value: 3.11.0 # Versão recomendada para o Render
        
    # ----------------------------------------------------------------
    # 2. Serviço de Frontend (Site Estático) - Exemplo
    # ----------------------------------------------------------------
  - type: static
    name: claunnetworking-main-site
    
    # Define a subpasta 'main-site' como o diretório raiz para este serviço
    rootDir: main-site
    
    # O site é estático puro, então não há comando de build
    buildCommand: ""
    
    # O Publish Directory é o próprio Root Directory (o ponto '.')
    publishPath: .
    
    # Variável crucial para sites estáticos sem package.json
    envVars:
      - key: SKIP_INSTALL_DEPS
        value: true
